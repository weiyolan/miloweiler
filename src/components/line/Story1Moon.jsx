import React, { useState, useEffect, useRef } from "react"
// import { useDimensions } from "@/utils/useDimensions"
import { useAppContext } from "@utils/appContext.js"
import { Path, TextAnimate } from '@/components/line/pathUtils'
// import { SVGWrapper } from "./contextSVG"
import { usePageContext } from "@utils/pageContext"
// import { PageWrapper } from "@context/pageContext"
import AnimateSVG from "./AnimateSVG"
// import AnimateSVGBanner from "./AnimateSVGBanner"
import { gsap } from "gsap/dist/gsap"
import { ScrollTrigger } from "gsap/dist/ScrollTrigger"
import { PathGSAP } from "@/components/line/pathUtilsGsap"
// import useStateRef from "@/utils/useStateRef"
gsap.registerPlugin(ScrollTrigger)

let drops = [
  "M917 1572.92C917 1575.06 914.555 1577 912.295 1577C910.036 1577 908 1575.06 908 1572.92C908 1570.77 910.445 1570 912.705 1570C914.964 1570 917 1570.77 917 1572.92Z",
  "M916.679 1576.22C913.377 1579.6 913.18 1585.73 912.288 1585.97C911.225 1586.27 911.54 1583.89 910.637 1583.58C908.385 1582.81 912.826 1581.47 912.826 1577.35C912.826 1571.74 918.371 1574.49 916.679 1576.22Z",
  "M915.38 1584.34C916.34 1587.46 913.978 1591.84 908.478 1591.84C902.978 1591.84 901.522 1587.48 902.38 1584.34C903.88 1578.84 905.617 1582.84 908.88 1582.84C912.144 1582.84 913.38 1577.84 915.38 1584.34Z",
  "M916 1585.84C917.357 1590.15 915.723 1596.34 907.946 1596.34C900.169 1596.34 898.885 1589.34 901 1585.34C904.5 1578.72 903.9 1583.88 908.515 1583.88C913.129 1583.88 913.172 1576.84 916 1585.84Z",
  "M915.909 1592.91C917.266 1597.23 915.632 1603.41 907.855 1603.41C900.078 1603.41 898.795 1596.41 900.909 1592.41C903.024 1588.42 905 1588.84 907.5 1588.34C910 1587.84 914.47 1588.34 915.909 1592.91Z",
  "M915.5 1612.94C915.5 1617.8 911.694 1621.75 907 1621.75C902.306 1621.75 900 1617.8 900 1612.94C900 1608.07 908.5 1594.75 908.5 1599.25C908.5 1603.75 915.5 1608.75 915.5 1612.94Z",
]

export default function Story1Moon({ scrollMin, scrollMax, scrubTl0, scrubTl1, transitionTl, speed, setSvgHeight, setSvgWidth, setSvgTop, banner }) {

  // let { locale, scrolled, height: screenHeight } = useAppContext()

  let { mobile } = usePageContext()
  // const ctx = useRef(gsap.context(() => { }));
  // let tl = useRef()


  let tweens1 = [
    {
      timeline: transitionTl,
      id: "fullLegTrans",
      ratio: 1,
      attr: {
        duration: 3,
        // overwrite: true,
        // ease: 'ease.out',
      },
      position: 0.5
    },
    {
      timeline: scrubTl0,
      id: "fullLegScrub",
      ratio: 0.08,
      attr: { duration: 1 },
      position: 0
    },
  ]

  useEffect(() => {
    let tl = gsap.timeline()
      .to('#droplet', {
        opacity: 1,
        scale: 1,
        duration: 0.3,
        transformOrigin: '50% 50%',
      }, 0)
      .to('#droplet', {
        attr: { d: drops[1] },
        duration: 0.5,
      })
      .to('#droplet', {
        attr: { d: drops[2] },
        duration: 0.5,
      })
      .to('#droplet', {
        attr: { d: drops[3] },
        duration: 0.5,
      })
      .to('#droplet', {
        attr: { d: drops[4] },
        duration: 0.5,
      })
      .to('#droplet', {
        attr: { d: drops[5] },
        scale: 1.5,
        transformOrigin: '50% 50%',
        duration: 0.5,
      })

    scrubTl1 && scrubTl1
      .set('#droplet', {
      scale: 0,
      // opacity:0,
      transformOrigin: '50% 50%',
    })
      .add(tl, 0)
  }, [scrubTl1])

  let colorPrimary = "#FFF5EA";
  let n = 0;
  function getContent(mobile) {
    return mobile ?
      <g id='mobile'>
        {/* <Path scrolled={fakeScroll1} drawDuration='1' position={0} inverse={false} id="toAstridMob" d="M351 170C351 332.5 61.9999 266.5 20.5009 410C3.06634 470.287 61.5011 539 118 515" stroke="#FFFAEA" strokeWidth="2" strokeLinecap="round" /> */}
      </g> :
      <g id='desktopPage1'>

        {/* =============== SCROLLING LINE START ===============  */}
        <circle opacity={0} id="circleScroll" cx="942" cy="365" r="2" fill={colorPrimary} />

        {/* ========LEGS & FLOWER======= */}
        {/* scrolled={fakeScroll46.scroll / 1000} */}
        <PathGSAP tweens={tweens1} className='will-change-transform' mask="url(#mask1_322_1017)" id="fullLeg" scrolled={0} fillColor={colorPrimary} animateStroke={false} inverse={false} double={1} lengthFactor={1} d="M941.999 364L1163 832.5C1204.5 920.5 1283 894 1306 937.5C1333.2 988.941 1257 1024 1277.5 1060C1296.7 1093.72 1364 1092.5 1343.5 1128.5C1323 1164.5 1322 1182 1332 1204C1356.12 1260.47 1414 1271 1402.5 1300C1399.5 1306.5 1390.08 1293.11 1380 1297L1373.5 1297.87L1352.5 1300.5L1332 1288.5L1314.5 1297.87C1307.58 1294.32 1296.83 1286.22 1296 1293.5C1292 1328.5 1396.11 1354.33 1399.31 1338.2C1400.15 1334 1394.44 1335.27 1387.5 1332.5C1406.72 1325.51 1414.18 1323.31 1403 1355.5L1373.5 1360.5L1352.5 1353L1343 1355.5L1323.5 1344.5L1314.5 1347C1308.87 1343.44 1301.01 1333.67 1298 1342C1289.5 1365.5 1390.5 1402.73 1394.13 1382.93C1394.76 1379.5 1389.14 1378.95 1385 1378C1393.54 1367.75 1400.07 1371.03 1403 1390L1379 1398L1343 1390L1332 1400L1309 1390C1303.73 1390.41 1295 1387.53 1295 1393.5C1295 1418 1385.49 1423.58 1390.19 1405.91C1391.09 1402.5 1379.42 1405.37 1381.5 1404C1381.65 1400.14 1397.72 1394.98 1405 1402.5L1394.13 1428.5L1369 1432.5L1349 1439L1323.5 1432.5L1314.5 1443L1300.5 1460.5C1291.13 1482.99 1353.5 1478.5 1344.5 1501C1342.02 1505.21 1336.38 1503.74 1333 1500.5L1318.5 1496.5L1309 1499.5H1297.21L1284 1510C1284.86 1523.02 1305.1 1523.33 1306.5 1511C1306 1509 1294 1525 1295 1512C1296 1499 1347.5 1503.5 1345 1523.5C1344.68 1526.2 1343.8 1527.78 1334 1531.5L1335 1527.5L1321.5 1522L1310.5 1525L1297.21 1523.24L1289.5 1531.5L1281.5 1542.5C1282.17 1551.48 1296.07 1561.69 1298.5 1550C1294.75 1550.25 1291.74 1549 1291.5 1546C1290 1527.5 1352.5 1535 1323.5 1569C1294.5 1603 1254 1709 1291.5 1700.5C1329 1692 1222 1614.46 1114 1642.5C1035.5 1662.88 973.496 1727 973.496 1746.5C967 1715.5 961.5 1671.5 962 1651C962.028 1649.86 969 1639.5 971 1642.5C973 1645.5 961.702 1652.75 961.5 1650C959.296 1620 955.046 1600.5 952.5 1593.5C951.123 1589.71 942.612 1598.5 944.612 1600.5C947.374 1603.26 954.059 1594.36 952.113 1592.5C952.113 1591 954.613 1581.5 958.613 1583C962.613 1584.5 951.556 1594.01 951.113 1591.5C944.612 1572.5 925.065 1567.56 916.565 1570.56C916.575 1566.53 908.708 1563.16 906.465 1567.06C903.599 1572.05 908.611 1576.37 910.844 1576.5C912.902 1576.62 915.62 1573.23 916 1570.56C928 1569.68 926 1554.18 913.5 1567.06C922.906 1556.36 909.5 1552.18 910 1565.68C906 1553.68 892.5 1565.18 906 1569.68C891.817 1570.04 897.501 1581.38 907 1573.18C897 1584.68 916 1588.68 913.5 1575.18C918.344 1586.22 933.211 1570.55 916.565 1571.18" stroke="#FFF5EA" strokeWidth="2" strokeLinecap="round" />

        <mask id="mask1_322_1017" style={{ maskType: "alpha" }} maskUnits="userSpaceOnUse" x="867" y="352" width="655" height="1412">
          <path id="Subtract" fillRule="evenodd" clipRule="evenodd" d="M1522 358H867V1770H1522V358ZM1400.5 1305.5C1401.44 1300.77 1400.5 1294 1400.5 1294L1376.5 1281.5L1297.5 1288C1297.47 1288.42 1297.44 1288.86 1297.41 1289.32C1297.18 1292.48 1296.91 1296.18 1297.5 1299L1331.5 1322L1397 1339C1398.84 1336.91 1398.31 1333.83 1398.08 1332.48C1398.04 1332.28 1398.01 1332.12 1398 1332C1398.65 1330.82 1407.57 1343.99 1399 1347.5C1399 1348.7 1375 1348 1363 1347.5L1314.5 1332.5L1298 1337.5C1298.4 1340.7 1298.83 1344.83 1299 1346.5L1306.5 1350L1392 1383C1391.88 1380.47 1391.91 1378.81 1392 1375.5C1397.74 1375.78 1399.95 1386.91 1393 1392C1390.11 1394.11 1375.33 1392.67 1367.5 1391L1324 1383L1296 1388.5C1296 1390.5 1296 1393.5 1297 1395L1300.5 1398L1345.5 1405L1388.5 1406.5C1389.55 1405.38 1389.5 1403.5 1389 1402C1393.77 1402.79 1394.16 1409.66 1389.5 1414.5C1387.21 1416.88 1372.83 1423.17 1365 1425.5L1294 1427L1299 1454L1299.5 1460L1301 1462L1302 1463L1352 1476L1356.5 1497.5L1346.5 1507.5L1344 1504C1343.82 1502.56 1343.78 1500.94 1343.75 1499.67C1343.72 1498.24 1343.7 1497.26 1343.5 1497.5C1343.18 1497.9 1341.65 1497.3 1339.99 1496.65C1338.74 1496.16 1337.43 1495.64 1336.5 1495.5L1295 1491.5L1279.5 1509C1279.61 1509.95 1279.69 1510.85 1279.77 1511.72C1280.24 1517.04 1280.56 1520.64 1287 1521.5C1294 1522 1312.22 1520.53 1308 1509L1296 1512.5L1296.01 1512.58C1296.24 1515.85 1296.47 1518.98 1293 1517C1292.02 1515.44 1291.55 1510.63 1293 1507C1293.8 1505 1299.33 1503.17 1300.5 1503L1318 1501L1341 1506.5L1348 1517.5L1347.5 1536.5L1344 1528C1344 1525.5 1344 1523 1342.5 1520.5C1341.39 1518.65 1337.47 1517.51 1334.65 1516.69C1334.42 1516.62 1334.21 1516.56 1334 1516.5L1306 1519.5L1292 1523.5L1283 1531.5L1277.5 1546L1286.5 1559.5C1301.63 1559.65 1307 1545.5 1293.5 1546C1292.81 1547.43 1293 1548.67 1293.5 1551C1288.57 1547.74 1288.07 1544.62 1291.5 1540.5C1293.53 1538.06 1293.16 1536.11 1292.97 1535.15C1292.9 1534.77 1292.86 1534.55 1293 1534.5L1308.5 1532L1323 1534.5L1336 1547.5L1343 1551L1377 1535.5L1440.5 1392L1400.5 1305.5Z" fill="#D9D9D9" />
        </mask>
        {/* ====== WATER DROP ========  */}
        <path className={`opacity-0`} id="droplet" d="M917 1572.92C917 1575.06 914.555 1577 912.295 1577C910.036 1577 908 1575.06 908 1572.92C908 1570.77 910.445 1570 912.705 1570C914.964 1570 917 1570.77 917 1572.92Z" fill="#FFF5EA" />
        {/* <path className={`opacity-0`} id="dropleta" d="M916.679 1576.22C913.377 1579.6 913.18 1585.73 912.288 1585.97C911.225 1586.27 911.54 1583.89 910.637 1583.58C908.385 1582.81 912.826 1581.47 912.826 1577.35C912.826 1571.74 918.371 1574.49 916.679 1576.22Z" fill="#FFF5EA" /> */}
        {/* <path className={`opacity-0`} id="droplet1" d="M915.38 1584.34C916.34 1587.46 913.978 1591.84 908.478 1591.84C902.978 1591.84 901.522 1587.48 902.38 1584.34C903.88 1578.84 905.617 1582.84 908.88 1582.84C912.144 1582.84 913.38 1577.84 915.38 1584.34Z" fill="#FFF5EA" /> */}
        {/* <path className={`opacity-0`} id="droplet2" d="M916 1585.84C917.357 1590.15 915.723 1596.34 907.946 1596.34C900.169 1596.34 898.885 1589.34 901 1585.34C904.5 1578.72 903.9 1583.88 908.515 1583.88C913.129 1583.88 913.172 1576.84 916 1585.84Z" fill="#FFF5EA" /> */}
        {/* <path className={`opacity-0`} id="droplet3" d="M915.909 1592.91C917.266 1597.23 915.632 1603.41 907.855 1603.41C900.078 1603.41 898.795 1596.41 900.909 1592.41C903.024 1588.42 905 1588.84 907.5 1588.34C910 1587.84 914.47 1588.34 915.909 1592.91Z" fill="#FFF5EA" /> */}
        {/* <path className={`opacity-0`} id="droplet4" d="M915.5 1612.94C915.5 1617.8 911.694 1621.75 907 1621.75C902.306 1621.75 900 1617.8 900 1612.94C900 1608.07 908.5 1594.75 908.5 1599.25C908.5 1603.75 915.5 1608.75 915.5 1612.94Z" fill="#FFF5EA" /> */}
        {/* <path id="droplet5" d="M919.505 1619C918.963 1620.36 893.922 1622.61 894.5 1619.5C894.5 1615 904.232 1620.93 903.5 1618C901 1608 914.5 1611 911 1616.5C907.5 1622 921.213 1614.72 919.505 1619Z" fill="#FF0000"/> */}
        {/* <path id="droplet5b" d="M910.5 1619.25C910.5 1620.17 908.462 1621 906.58 1621C904.697 1621 903 1620.17 903 1619.25C903 1618.33 905.038 1618 906.92 1618C908.803 1618 910.5 1618.33 910.5 1619.25Z" fill="#FF0000"/> */}
        <path className={`opacity-0`} id="dropletEnd" d="M909.985 2338.74C909.985 2341.96 907.132 2344.87 904.496 2344.87C901.86 2344.87 899.485 2341.96 899.485 2338.74C899.485 2335.52 902.338 2334.37 904.974 2334.37C907.609 2334.37 909.985 2335.52 909.985 2338.74Z" fill="#FFF5EA" />
        {/* <path className={`opacity-0`} id="droplet7" d="M909.985 2343.12C909.985 2344.04 907.947 2344.87 906.064 2344.87C904.182 2344.87 902.485 2344.04 902.485 2343.12C902.485 2342.2 904.523 2341.87 906.405 2341.87C908.288 2341.87 909.985 2342.2 909.985 2343.12Z" fill="#FF0000"/> */}

        {/* INDICATOR OF DROPLET FALL HEIGHT */}
        {/* <path id="dropHeight" d="M907 2343L907 1618" stroke="#FF0000" strokeWidth="2" /> */}
      </g>
  }



  return (<>
    <AnimateSVG alt='miloweiler photography logo animation'
      scrollMin={scrollMin} scrollMax={scrollMax} speed={speed} setSvgHeight={setSvgHeight} setSvgTop={setSvgTop} setSvgWidth={setSvgWidth}>

      {getContent(mobile)}

    </AnimateSVG>


  </>
  )
}